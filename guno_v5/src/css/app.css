:root{
  --gap:10px;
  --radius:12px;
  --header-h: 54px; /* v4.05っぽく控えめ */
  --left: 1.05fr;
  --right: 0.95fr;
  --right-top: 0.56fr;
  --right-bottom: 0.44fr;
}

/* “dvh”優先（Web公開でも安定）。古い環境はvhにフォールバック */
body{
  overflow:hidden;
  height:100vh;
  height:100dvh;
  padding:10px;
  box-sizing:border-box;
}

/* ===== Header：左(ダッシュボード)上だけでOKにする ===== */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  height:var(--header-h);
  margin-bottom:10px;
  background:#1f1f1f;
  border:1px solid #333;
  border-radius:12px;
  padding:8px 12px;
  box-sizing:border-box;
}
.controls button{
  border:1px solid #444;
  background:#2a2a2a;
  color:#eee;
  border-radius:10px;
  padding:6px 10px;
  cursor:pointer;
  font-weight:700;
}
.controls button:hover{ filter:brightness(1.1); }
.btn-manual{ background:#2a2a2a; }
.btn-auto{ background:#1f7a1f; }

/* ===== 全体：左＝dashboard、右＝(slots/map) ===== */
.game-container{
  display:grid;
  grid-template-columns: var(--left) var(--right);
  grid-template-rows: 1fr; /* 左は1枚、右は内部で分割 */
  gap:var(--gap);
  height: calc(100% - var(--header-h) - 10px);
  min-height:0;
}

/* v5 index.html の .left-col を “中身透過”させて v4.05配置 */
.left-col{ display:contents; }

/* dashboard：左全面 */
.panel-dashboard{
  grid-column:1;
  grid-row:1;
  display:flex;
  flex-direction:column;
  min-height:0;
  overflow:hidden;
}

/* slots + map は右カラム内で上下 */
.panel-slots{
  grid-column:2;
  grid-row:1;
  display:flex;
  flex-direction:column;
  min-height:0;
  overflow:hidden;
}
.panel-map{
  grid-column:2;
  grid-row:1;
  display:flex;
  flex-direction:column;
  min-height:0;
  overflow:hidden;
}

/* 右カラムを上下2分割するために、panel-slotsとpanel-mapをラップできないので
   “擬似的に” slotsを上、mapを下にする：panel-mapに上マージンで下へ */
.panel-slots{ height: calc(100% * var(--right-top)); }
.panel-map{ height: calc(100% * var(--right-bottom)); margin-top: var(--gap); }

/* players area は中だけスクロール（v4.05っぽい） */
#players-area{
  overflow:auto;
  min-height:0;
  padding-right:4px;
}

/* slots grid */
#slots-area{
  display:grid;
  grid-template-columns: 1fr;
  gap:10px;
  overflow:hidden;
  min-height:0;
}

/* 10駅を“絶対に1行”にする */
.map-grid{
  --cols: 10;
  display:grid;
  gap: var(--card-gap);
  justify-content:center;
  grid-template-columns: repeat(var(--cols), minmax(0, var(--card-w)));
  grid-auto-rows: var(--card-h);
}

/* 路線ヘッダは短く（[JY]だけ等） */
.line-header{
  font-weight:900;
  font-size:12px;
  margin:0 0 6px;
  padding:3px 8px;
  border-radius:999px;
  color:#fff;
  text-align:left;
  display:inline-flex;
  align-items:center;
  gap:8px;
}

/* スロット（空） */
.slot{
  background:#2a2a2a;
  border:1px solid #3d3d3d;
  border-radius:8px;
  aspect-ratio: 2 / 3;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-weight:900;
  position:relative;
  overflow:hidden;
}

/* map */
#map{
  width:100%;
  height:100%;
  min-height:200px;
  border-radius:12px;
  overflow:hidden;
}

/* ===== モバイル：縦積み（横は諦める方針） ===== */
@media (max-width: 1023px){
  :root{
    --header-h: 54px;
    --left:1fr;
    --right:1fr;
    --card-w: clamp(34px, 7vw, 56px);
  }
  .game-container{
    grid-template-columns: 1fr;
    grid-template-rows: auto auto auto;
    height: calc(100% - var(--header-h) - 10px);
    overflow:hidden;
  }
  .panel-dashboard{ grid-column:1; grid-row:1; height:42dvh; }
  .panel-slots{ grid-column:1; grid-row:2; height:28dvh; margin-top:0; }
  .panel-map{ grid-column:1; grid-row:3; height:30dvh; margin-top: var(--gap); }
}