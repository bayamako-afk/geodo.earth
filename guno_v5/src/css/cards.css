#slots-area { display: grid; grid-template-columns: 1fr; gap: 12px; min-width: 0; }
.line-wrapper { container-type: inline-size; min-width: 0; }
.map-grid {
    --cols: 6;
    display: grid; gap: var(--card-gap); justify-content: center;
    grid-template-columns: repeat(var(--cols), minmax(0, var(--card-w)));
    grid-auto-rows: var(--card-h);
}

@supports (width: 1cqw) {
    .map-grid {
        --card-gap: clamp(4px, 1.2cqw, 8px);
        --card-w: clamp(28px, calc((100cqw - ((var(--cols) - 1) * var(--card-gap))) / var(--cols)), 90px);
        --card-h: calc(var(--card-w) * 1.5);
    }
    @container (min-width: 380px) { .map-grid { --cols: 10; } }
    @container (min-width: 280px) and (max-width: 379px) { .map-grid { --cols: 7; } }
    @container (max-width: 279px) { .map-grid { --cols: 5; } }
}

.line-header { font-weight: bold; font-size: 13px; margin-bottom: 5px; padding: 3px 8px; border-radius: 4px; color: #fff; width: 100%; box-sizing: border-box; text-align: center; }
.slot { background: #2a2a2a; border: 1px solid #3d3d3d; border-radius: 5px; aspect-ratio: 2 / 3; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 13px; color: #fff; position: relative; transition: transform 0.2s; transform-origin: center; overflow: visible; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.9), -1px -1px 2px rgba(0,0,0,0.9), 1px -1px 2px rgba(0,0,0,0.9), -1px 1px 2px rgba(0,0,0,0.9); }
.slot.active { z-index: 5; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }
@media (hover: hover) { .slot.active:hover { transform: scale(1.3); z-index: 100; } }

.card { display: inline-block; width: var(--card-w); height: var(--card-h); background-color: #fff; border-radius: 4px; margin: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.3); background-size: contain; background-repeat: no-repeat; background-position: center; border: 2px solid #ccc; transition: transform .12s cubic-bezier(.2,.8,.2,1), box-shadow .12s ease; position: relative; }
@media (hover: hover) { .card:hover, .guno-card:hover { transform: scale(1.6) translateY(20px); transform-origin: center; z-index: 9999; box-shadow: 0 16px 50px rgba(0,0,0,.45); } }

.card.playable { cursor: pointer; border: 2px solid #4CAF50; box-shadow: 0 0 12px rgba(76, 175, 80, 0.8); }
.card.unplayable { filter: grayscale(100%) brightness(0.4); opacity: 0.5; }

.card-large {
  width: var(--card-w);
  height: var(--card-h);
  border-radius: 4px;
}
#draw-pile-visual { 
    width: var(--card-w); height: calc(var(--card-w) * 88 / 63);  background-image: url('../assets/cards/GUNO_BACK.png'); 
    background-size: contain; background-repeat: no-repeat; background-position: center;
    background-color: #444; border: 2px solid #666; border-radius: 4px; 
    display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; color: white; text-shadow: 1px 1px 3px #000;
}
#draw-pile-visual.can-draw { cursor: pointer; border-color: #4CAF50; box-shadow: 0 0 20px rgba(76,175,80,0.85); transform: translateY(-1px); }

#hint-area { background: rgba(76, 175, 80, 0.1); color: #4CAF50; border-radius: 6px; padding: 6px 8px; margin-bottom: 8px; font-weight: bold; text-align: center; font-size: 13px; border: 1px dashed #4CAF50; height: 18px; }



/* ====== GUNO Card Overlay (Digital V1) ====== */
.guno-card {
  --w: 220px;                /* カード幅：ここを変えると全体スケール */
  --h: calc(var(--w) * 88 / 63);

  --line: #00AA00;           /* default */
  --bg: url("../assets/cards/bg_JY.png");    /* default */

  --num-size: calc(var(--w) * 0.32);
  --corner-size: calc(var(--w) * 1.0);  /* 円のサイズ：カード幅と同じ（左右に接する） */

  --jp-size: calc(var(--w) * 0.14);
  --en-size: calc(var(--w) * 0.065);

  position: relative;
  width: var(--w);
  height: var(--h);
  border-radius: calc(var(--w) * 0.06);
  overflow: hidden;
  background-size: cover;  /* 100% 100%からcoverに変更して角を隠す */
  background-position: center;  /* 中央配置 */

  background: var(--line);

  font-family: "Noto Sans JP", system-ui, -apple-system, "Segoe UI", sans-serif;
  user-select: none;
  transition: transform .12s cubic-bezier(.2,.8,.2,1), box-shadow .12s ease;
}


/* 路線別 */
.guno-card[data-line="JY"] { --line:#00AA00; }
.guno-card[data-line="M"]  { --line:#E60012; }
.guno-card[data-line="G"]  { --line:#F39700; }
.guno-card[data-line="T"]  { --line:#009BBF; }


/* ====== CSS Frame + Inner (Yamanote loop subtle pattern) ====== */
/* 外側は .guno-card の background(var(--line)) が担当 */
/* 内側白面＋薄い山手ループ模様 */
.guno-card::before{
  content:"";
  position:absolute;
  inset: var(--frame-pad);
  border-radius: var(--frame-radius);
  background:
    /* うっすら回路っぽいライン（画像に近い雰囲気） */
    linear-gradient(90deg, rgba(0,0,0,0.03) 0.8px, transparent 0.8px) 0 0 / 18% 18%,
    linear-gradient(0deg,  rgba(0,0,0,0.03) 0.8px, transparent 0.8px) 0 0 / 18% 18%,

    /* 山手ループ：中央リング（超薄） */
    radial-gradient(circle at 50% 54%,
      rgba(0,0,0,var(--loop-alpha)) 0%,
      rgba(0,0,0,var(--loop-alpha)) 33%,
      transparent 34%,
      transparent 46%,
      rgba(0,0,0,calc(var(--loop-alpha) * 0.65)) 47%,
      rgba(0,0,0,calc(var(--loop-alpha) * 0.65)) 52%,
      transparent 53%),

    /* 紙地 */
    linear-gradient(#ffffff, #fbfbf8);
  background-blend-mode: multiply;
}

/* 2本目の白ライン（画像の二重枠） */
.guno-card::after{
  content:"";
  position:absolute;
  inset: calc(var(--frame-pad) + var(--frame-gap));
  border-radius: var(--inner-radius);
  border: calc(var(--w) * 0.012) solid rgba(255,255,255,0.95);
  box-shadow: 0 0 0 calc(var(--w) * 0.006) rgba(255,255,255,0.85) inset;
  pointer-events:none;
}

/* 内側要素は白面の上に */
.guno-card .corner,
.guno-card .center,
.guno-card .route-code{
  z-index: 2;
}


/* コーナー */
.corner{
  position:absolute;
  width: var(--corner-size);
  height: var(--corner-size);
  pointer-events:none;
}

/* 半円の元（円） */
.corner-bg{
  position:absolute;
  inset:0;
  background: var(--line);
  border-radius: 50%;
  box-shadow:
    inset 0 4px 8px rgba(0,0,0,0.25),
    inset 0 -2px 4px rgba(255,255,255,0.15);
}

/* 数字は “角ごとに” 絶対配置する */
.corner-num{
  position:absolute;
  font-weight: 900;
  font-size: var(--num-size);
  line-height: 1;
  color:#fff;

  /* 擬似アウトライン */
  text-shadow:
    -2px -2px 0 #000,  0px -2px 0 #000,  2px -2px 0 #000,
    -2px  0px 0 #000,                 2px  0px 0 #000,
    -2px  2px 0 #000,  0px  2px 0 #000,  2px  2px 0 #000;
}

/* 角の配置（ここはcorner-size基準のままでOK） */
.corner--tl{
  top: calc(var(--corner-size) * -0.5);
  left: calc(var(--corner-size) * -0.5);
}
.corner--br{
  bottom: calc(var(--corner-size) * -0.5);
  right: calc(var(--corner-size) * -0.5);
}

/* ★数字の位置：見えている半円の中心へ寄せる（ここが肝） */
.corner--tl .corner-num{
  left: 70%;
  top: 70%;
  transform: translate(-50%,-50%);
}
.corner--br .corner-num{
  left: 30%;
  top: 30%;
  transform: translate(-50%,-50%) rotate(180deg);
}

  /* 擬似アウトライン */
  text-shadow:
    -2px -2px 0 #000,  0px -2px 0 #000,  2px -2px 0 #000,
    -2px  0px 0 #000,                 2px  0px 0 #000,
    -2px  2px 0 #000,  0px  2px 0 #000,  2px  2px 0 #000;
}
.corner--tl{
  top: calc(var(--corner-size) * -0.5);
  left: calc(var(--corner-size) * -0.5);
  align-items:center;
  justify-content:center;
}

.corner--br{
  bottom: calc(var(--corner-size) * -0.5);
  right: calc(var(--corner-size) * -0.5);
  align-items:center;
  justify-content:center;
}
.corner-num--rot{ transform: rotate(180deg); transform-origin:center; }

/* 中央駅名 */
.center{
  position:absolute;
  left: 50%;
  top: 52%;
  transform: translate(-50%, -50%);
  width: 82%;
  text-align:center;
  pointer-events:none;
}
.station-jp{
  font-weight: 900;
  font-size: var(--jp-size);
  line-height: 1.05;
  color:#000;
  letter-spacing: 0.02em;
  text-shadow:
    -2px -2px 0 #fff, 0px -2px 0 #fff, 2px -2px 0 #fff,
    -2px  0px 0 #fff,              2px  0px 0 #fff,
    -2px  2px 0 #fff, 0px  2px 0 #fff, 2px  2px 0 #fff,
    0 0 4px rgba(255,255,255,0.8);
}
.station-en{
  margin-top: calc(var(--w) * 0.015);
  font-weight: 800;
  font-size: var(--en-size);
  line-height: 1.1;
  color:#000;
  letter-spacing: 0.03em;
  text-shadow:
    -1.5px -1.5px 0 #fff, 0px -1.5px 0 #fff, 1.5px -1.5px 0 #fff,
    -1.5px  0px 0 #fff,              1.5px  0px 0 #fff,
    -1.5px  1.5px 0 #fff, 0px  1.5px 0 #fff, 1.5px  1.5px 0 #fff,
    0 0 3px rgba(255,255,255,0.8);
}

/* 2文字駅名用：フォントサイズを大きく */
.station-jp.short-name {
  font-size: calc(var(--jp-size) * 1.3);  /* 1.3倍に拡大 */
}

/* ルートコード */
.route-code{
  position:absolute;
  left: calc(var(--w) * 0.14);
  bottom: calc(var(--w) * 0.10);
  font-weight: 800;
  font-size: calc(var(--w) * 0.07);

  color: var(--line);   /* ★ここを変更 */
  text-shadow:
    -1.5px -1.5px 0 #000, 0px -1.5px 0 #000, 1.5px -1.5px 0 #000,
    -1.5px  0px   0 #000,                  1.5px  0px   0 #000,
    -1.5px  1.5px 0 #000, 0px  1.5px 0 #000, 1.5px  1.5px 0 #000; /* ★縁を黒に */
}

/* デッキ表示用：カード一覧 */
.guno-card-grid{
  display:flex;
  flex-wrap:wrap;
  gap: 12px;
  align-items:flex-start;
}

/* 小さめ表示（必要なら） */
.guno-card.is-small{ --w: 170px; }

/* 画面幅に合わせる */
@media (max-width: 480px){ .guno-card{ --w: 180px; } }
@media (max-width: 360px){ .guno-card{ --w: 160px; } }

/* ====== 停電カード：背景は路線背景そのまま、上に雷を重ねる ====== */
.guno-card--teiden::before {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.25);  /* 暗幕で「やばいカード感」を演出 */
  pointer-events: none;
  z-index: 1;
}

.guno-card--teiden .corner,
.guno-card--teiden .center,
.guno-card--teiden .route-code {
  display: none; /* 数字、駅名、ルートコードを非表示 */
}

.guno-card--teiden .teiden-icon {
  position: absolute;
  left: 50%;
  top: 35%;  /* 上に移動 */
  transform: translate(-50%, -50%);
  font-size: calc(var(--w) * 0.38); /* 雷の大きさを少し縮小 */
  line-height: 1;
  color: #fff;
  text-shadow:
    -4px -4px 0 #000, 0px -4px 0 #000, 4px -4px 0 #000,
    -4px  0px 0 #000,               4px  0px 0 #000,
    -4px  4px 0 #000, 0px  4px 0 #000, 4px  4px 0 #000;
  pointer-events: none;
  z-index: 2;  /* 暗幕の上に表示 */
}

.guno-card--teiden .teiden-sub {
  position: absolute;
  left: 50%;
  top: 58%;  /* 雷との間隔を確保 */
  transform: translateX(-50%);
  font-size: calc(var(--w) * 0.14); /* 駅名日本語と同じサイズ */
  font-weight: 900;
  line-height: 1.05;
  color: #000; /* 黒文字 */
  text-shadow:
    -2px -2px 0 #fff, 0px -2px 0 #fff, 2px -2px 0 #fff,
    -2px  0px 0 #fff,              2px  0px 0 #fff,
    -2px  2px 0 #fff, 0px  2px 0 #fff, 2px  2px 0 #fff,
    0 0 4px rgba(255,255,255,0.8); /* 白縁 */
  pointer-events: none;
  z-index: 2;  /* 暗幕の上に表示 */
}

.guno-card--teiden .teiden-en {
  position: absolute;
  left: 50%;
  top: 68%;  /* 停電との間隔を確保 */
  transform: translateX(-50%);
  font-size: calc(var(--w) * 0.065); /* 駅名英語と同じサイズ */
  font-weight: 700;
  line-height: 1.2;
  color: #000; /* 黒文字 */
  text-shadow:
    -1.5px -1.5px 0 #fff, 0px -1.5px 0 #fff, 1.5px -1.5px 0 #fff,
    -1.5px  0px 0 #fff,              1.5px  0px 0 #fff,
    -1.5px  1.5px 0 #fff, 0px  1.5px 0 #fff, 1.5px  1.5px 0 #fff,
    0 0 3px rgba(255,255,255,0.8); /* 白縁 */
  pointer-events: none;
  z-index: 2;  /* 暗幕の上に表示 */
}

/* スロットの停電カードはプレイヤーカード比率に合わせる */
.slot.guno-card{
  aspect-ratio: auto;      /* 2/3 を無効化 */
  width: var(--card-w);
  height: calc(var(--card-w) * 88 / 63);
}

/* === FIX: スロット内の実カード（停電/駅）を手札サイズに揃える === */
.map-grid .slot.active.guno-card,
#map-blackout .slot.active.guno-card{
  /* 手札と同じ基準幅 */
  --w: var(--card-w);

  /* .slot の aspect-ratio(2/3) を無効化し、guno-card比率(88/63)に固定 */
  aspect-ratio: auto !important;
  width: var(--card-w) !important;
  height: calc(var(--card-w) * 88 / 63) !important;

  /* グリッドのセルに引き伸ばされないよう中央寄せ */
  justify-self: center;
  align-self: center;
}

/* ====== PATCH: GUNOカードを画像なし + 内側白面 + 超薄い山手ループ ====== */
.guno-card{
  background: var(--line) !important; /* 外枠＝路線色 */
  position: relative;
  overflow: hidden;
  isolation: isolate; /* 擬似要素の重なり事故を防ぐ */
}

/* 内側の白面＋模様 */
.guno-card::before{
  content:"";
  position:absolute;
  inset: calc(var(--w) * 0.04);
  border-radius: calc(var(--w) * 0.05);
  z-index: 0;

  /* 白面＋超薄いループ模様（印刷想定で薄め） */
  background:
    /* うっすら回路っぽい線（好みでOFF可） */
    linear-gradient(90deg, rgba(0,0,0,0.03) 0.8px, transparent 0.8px) 0 0 / 18% 18%,
    linear-gradient(0deg,  rgba(0,0,0,0.03) 0.8px, transparent 0.8px) 0 0 / 18% 18%,

    /* 中央リング（山手ループ風） */
    radial-gradient(circle at 50% 54%,
      rgba(0,0,0,0.05) 0%,
      rgba(0,0,0,0.05) 33%,
      transparent 34%,
      transparent 46%,
      rgba(0,0,0,0.035) 47%,
      rgba(0,0,0,0.035) 52%,
      transparent 53%),

    /* 紙地 */
    linear-gradient(#ffffff, #fbfbf8);
  background-blend-mode: multiply;
}

/* 二重白ライン */
.guno-card::after{
  content:"";
  position:absolute;
  inset: calc(var(--w) * 0.058);
  border-radius: calc(var(--w) * 0.045);
  z-index: 1;

  border: calc(var(--w) * 0.012) solid rgba(255,255,255,0.95);
  box-shadow: 0 0 0 calc(var(--w) * 0.006) rgba(255,255,255,0.85) inset;
  pointer-events:none;
}

/* 中身（数字/駅名/路線コード）を一番上に */
.guno-card .corner,
.guno-card .center,
.guno-card .route-code{
  z-index: 2;
  position: absolute; /* すでにabsoluteならOK。上書きされても安全 */
}

/* ===== GUNO BACK: base image + CSS animated overlay ===== */
.guno-back{
  position: relative;
  overflow: hidden;
  border-radius: 4px; /* 既存に合わせる */
  background-image: url("../assets/cards/GUNO_BACK.png");
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
}

/* 1) 回転する“薄いリング光” */
.guno-back::before{
  content:"";
  position:absolute;
  inset: -20%;
  pointer-events:none;
  opacity: .55;
  mix-blend-mode: screen;

  background:
    radial-gradient(circle at 50% 52%, rgba(80,255,180,.20) 0 18%, transparent 19%),
    radial-gradient(circle at 50% 52%, rgba(80,255,180,.14) 0 26%, transparent 27%),
    radial-gradient(circle at 50% 52%, rgba(80,255,180,.10) 0 34%, transparent 35%);

  animation: gunoBackSpin 10s linear infinite;
}

/* 2) 斜めに走る“スキャン光” */
.guno-back::after{
  content:"";
  position:absolute;
  inset:-30%;
  pointer-events:none;
  opacity: .35;
  mix-blend-mode: screen;

  background:
    linear-gradient(120deg,
      transparent 0%,
      rgba(255,255,255,.00) 35%,
      rgba(255,255,255,.20) 45%,
      rgba(255,255,255,.00) 55%,
      transparent 100%);

  animation: gunoBackSweep 2.8s ease-in-out infinite;
}

@keyframes gunoBackSpin{
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}

@keyframes gunoBackSweep{
  0%   { transform: translateX(-12%) translateY(8%); }
  50%  { transform: translateX(12%)  translateY(-8%); }
  100% { transform: translateX(-12%) translateY(8%); }
}

/* 動きが苦手な人向け */
@media (prefers-reduced-motion: reduce){
  .guno-back::before,
  .guno-back::after{ animation: none !important; }
}

#draw-pile-visual{
  position: relative;
  overflow: hidden;
}
#draw-pile-visual::before,
#draw-pile-visual::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
}

/* ===== PATCH: draw pile back animation (force-visible) ===== */
#draw-pile-visual{
  position: relative;
  overflow: hidden;
  isolation: isolate;
}

/* 回転リング（分かりやすい濃さに） */
#draw-pile-visual::before{
  content:"";
  position:absolute;
  inset:-25%;
  pointer-events:none;
  opacity:.75;
  mix-blend-mode: screen;

  background:
    radial-gradient(circle at 50% 52%, rgba(120,255,200,.35) 0 18%, transparent 19%),
    radial-gradient(circle at 50% 52%, rgba(120,255,200,.22) 0 26%, transparent 27%),
    radial-gradient(circle at 50% 52%, rgba(120,255,200,.16) 0 34%, transparent 35%);

  animation: gunoBackSpin 6s linear infinite;
}

/* スキャン光（必ず気づく） */
#draw-pile-visual::after{
  content:"";
  position:absolute;
  inset:-35%;
  pointer-events:none;
  opacity:.55;
  mix-blend-mode: screen;

  background:
    linear-gradient(120deg,
      transparent 0%,
      rgba(255,255,255,0) 35%,
      rgba(255,255,255,.35) 45%,
      rgba(255,255,255,0) 55%,
      transparent 100%);

  animation: gunoBackSweep 2.2s ease-in-out infinite;
}

@keyframes gunoBackSpin{
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}
@keyframes gunoBackSweep{
  0%   { transform: translateX(-18%) translateY(12%); }
  50%  { transform: translateX(18%)  translateY(-12%); }
  100% { transform: translateX(-18%) translateY(12%); }
}

/* 動きを減らす設定の人向け */
@media (prefers-reduced-motion: reduce){
  #draw-pile-visual::before,
  #draw-pile-visual::after{ animation:none !important; }
}